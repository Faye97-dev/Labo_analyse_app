{% csrf_token %}
<div class="g-bg-lightblue-v10-opacity-0_5 g-pa-20">
    <div class="row"> 
        <div class="col-xl-12">
            <!-- Income Cards -->
            <div class="card g-brd-gray-light-v7 u-card-v1 g-mb-30">
                <header class="media g-pa-15 g-pa-25-30-0--md g-mb-20">
                    <div class="media-body align-self-center">
                        <h3 class="g-line-height-1 g-font-weight-300 g-font-size-28 g-color-secondary">Mon Profil 
                            <i class="hs-admin-user g-color-gray-dark-v3 g-font-size-26 g-px-10"></i>
                        </h3>
                        
                    </div>
                </header>
            </div>
            <div class="card g-brd-gray-light-v7 u-card-v1 g-pa-30 g-py-15 g-pa-0-30-25--md">
                <br><br>
                    <form id='form_profil-admin'>
                        <header>
                            <h2 class="text-uppercase g-font-size-12 g-font-size-default--md g-color-primary mb-0">Informations Generale</h2>
                            <hr class="d-flex g-brd-gray-dark-v12 g-my-10 g-my-30--md">
                        </header>
                        
                        <div class="form-group row g-mb-25">
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label">Nom complet</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-color-gray-dark-v12 g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="text" name='name_nom' value="{{admin.nom}}">
                            </div>
                        </div>
                        <div class="form-group row g-mb-25">
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label">NNI</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-color-gray-dark-v12 g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="text" name='name_nni' value="{{admin.nni}}">
                            </div>
                        </div>
                        <div class="form-group row g-mb-25">
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label">Numero</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-color-gray-dark-v12 g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="number" name='name_tel' value="{{admin.tel}}">
                            </div>
                        </div>
                        <div class="form-group row g-mb-25">
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label">Adresse</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-color-gray-dark-v12 g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="text" name='name_adresse' value="{{admin.adresse}}">
                            </div>
                        </div>
                        <div class="form-group row g-mb-25">
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label">Email</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-color-gray-dark-v12 g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="email" name='name_email' value="{{admin.email}}">
                            </div>
                        </div>
                        <div class="form-group row g-mb-25">
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label">Poste</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-color-gray-dark-v12 g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="text" name='name_poste' value="{{admin.poste}}">
                            </div>
                        </div>
                        <br><br>

                        <header>
                            <h2 class="text-uppercase g-font-size-12 g-font-size-default--md g-color-primary mb-0">Informations sur le compte</h2>
                            <hr class="d-flex g-brd-gray-dark-v12 g-my-10 g-my-30--md">
                        </header>
                        
                        <div class="form-group row g-mb-25" id='input_div-username'>
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label">Username</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="text" name='name_username' value="{{user.username}}">
                            </div>
                        </div>

                        <label class="d-flex align-items-center justify-content-between">
                            <span>Voulez vous modifier votre mot de passe courant ?</span>
                            <div class="u-check">
                                <input class="g-hidden-xs-up g-pos-abs g-top-0 g-right-0" id="mdp_toogle" type="checkbox">
                                <div class="u-check-icon-radio-v7">
                                <i class="fa" data-check-icon="ï€Œ"></i>
                                </div>
                            </div>
                        </label>
                        <div class="form-group row g-mb-25" >
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label" id='label_input-mdp1'>Mot de passe</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="password" name='name_mdp1' id="mdp1-admin">
                                <small class = 'text-success text-justify g-font-size-12' id='info_valid-mdp1'>
                                    <i class="hs-admin-check text-success">
                                    </i>
                                    Commence par une lettre , accepte les lettres et chiffres et minimum 8 caracteres exemple : mdp12345 , M12345dp ... 
                                </small>
                                <small class = 'text-danger text-justify g-font-size-12' id='info_invalid-mdp1'>
                                    <i class="hs-admin-close text-danger">
                                    </i>
                                    Pas des caracteres speciaux et espaces 
                                </small>
                            </div>
                        </div>
                        <div class="form-group row g-mb-25" >
                            <label for="example-tel-input" class="col-sm-5 col-md-4 col-lg-3 col-xl-2 col-form-label" id='label_input-mdp2'>Confirmation du mot de passe</label>
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-10">
                                <input class="form-control form-control-md g-brd-gray-light-v2 g-brd-secondary--focus g-rounded-4 g-px-6 g-py-5" type="password" name='name_mdp2' id="mdp2-admin">
                            </div>
                        </div>
                        
                        <div class="form-group row g-mb-25" >
                            <div class="col-sm-7 col-md-8 col-lg-9 col-xl-9">
                            </div>
                            <div class="col-sm-5 col-md-4 col-lg-3 col-xl-3 d-flex align-self-end justify-content-end">
                                <button class=" btn btn-md btn-xl--md u-btn-secondary g-width-165--md g-font-size-12 g-font-size-default--md g-mb-10" id='save-btn' type='button'> Enregistrer </button>
                            </div>
                        </div>

                        <span id='admin-id' style='display:none'>{{admin.id}}</span>
                    </form>
               
            </div>
        </div>
    </div>
</div>

<script>
    //
    var toggle_state = false ;
    $("#mdp1-admin").css('display','none')
    $("#label_input-mdp1").css('display','none')
    $("#info_invalid-mdp1").css('display','none')
    $("#info_valid-mdp1").css('display','none')
    //
    $("#mdp2-admin").css('display','none')
    $("#label_input-mdp2").css('display','none')

    $("#mdp_toogle").change(function() {
        if(this.checked) {
            toggle_state = this.checked
            $("#mdp1-admin").css('display','block')
            $("#label_input-mdp1").css('display','block')
            $("#info_invalid-mdp1").css('display','block')
            $("#info_valid-mdp1").css('display','block')
            //
            $("#mdp2-admin").css('display','block')
            $("#label_input-mdp2").css('display','block')  
        }else{
            toggle_state = this.checked
            $("#mdp1-admin").css('display','none')
            $("#label_input-mdp1").css('display','none')
            $("#info_invalid-mdp1").css('display','none')
            $("#info_valid-mdp1").css('display','none')
            //
            $("#mdp2-admin").css('display','none')
            $("#label_input-mdp2").css('display','none')
        }
        //console.log(this.checked)
    });

    var data_profil;
    $("#save-btn").on("click", function(){
        form = $("#form_profil-admin").serializeArray()
        //console.log(form)
        data_profil =transformFormDatafunction(form)
        
        // profil id
        data_profil['admin_id']=$("#admin-id").text().trim()
        data_profil['toogle']=toggle_state
        //console.log(toggle_state)
        if(toggle_state){
            if( required_fields(data_profil,['name_nni','name_nom','name_tel','name_email','name_username','name_mdp1'])){ 
                check_pwd = CheckPassword(data_profil['name_mdp1'])
                if( check_pwd ){
                    if(data_profil['name_mdp1'] === data_profil['name_mdp2']){
                        console.log(data_profil)
                        // submit data
                        var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
                        GplFwk.ajax.getAjax('edit_profil-admin',"main-div","POST",'data=' + JSON.stringify(data_profil), csrftoken)                
                    }else{
                        alert('Les mots de passe ne sont pas conformes !!')
                    }
                    
                }else{
                    alert('Format du mot de passe est invalid !!')
                }
                    
            }else{
                alert('Des champs non renseignes !!')
            }  
        }else{
            if( required_fields(data_profil,['name_nni','name_nom','name_tel','name_email','name_username'])){
                console.log(data_profil)
                // submit data
                var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
                GplFwk.ajax.getAjax('edit_profil-admin',"main-div","POST",'data=' + JSON.stringify(data_profil), csrftoken)  
            }else{
                alert('Des champs non renseignes !!')
            }  

        }
          
    })

    var CheckPassword = function (inputtxt) { 
        var passw =  /^[A-Za-z]\w{7,20}$/ ;
        //console.log(inputtxt)
        if(inputtxt.match(passw)) { 
            console.log('passw Correct ... !')
            return true;
        }
        else{ 
            console.log('passw Wrong...!')
            return false;
        }
    }

    var transformFormDatafunction = function (a) {
        var data = {}

        for (var i = 0; i < a.length; i++) {          
            data[a[i].name] = a[i].value
        }
        
        return data;
    }

    var required_fields = function (data,fields) {
        var valid = true
        for (var i = 0; i < fields.length; i++) {      
            valid = valid && data[fields[i]] !== ""
            if (! valid) {
                console.log(' field required .. ',fields[i])
                return valid
            }   
        }
        return valid
    }

</script>